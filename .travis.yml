language: node_js
sudo: false
node_js:
- 'node'

addons:
  chrome: stable

cache:
  yarn: true
  directories:
    - node_modules
    - "$HOME/.npm"
    - "$HOME/.cache"

# Just use yarn commands for now, as this gets more complex lets break out
# into a shell script
env:
  - YARN_COMMAND="install --frozen-lockfile"
  - YARN_COMMAND="upgrade"
  - YARN_COMMAND="upgrade && yarn add firebase@canary"

matrix:
  fast_finish: true
  allow_failures:
    - env: YARN_COMMAND="upgrade"
    - env: YARN_COMMAND="upgrade && yarn add firebase@canary"

branches:
  only:
    - master # otherwise pull requests get built twice

install:
  - yarn `echo $YARN_COMMAND`

script:
  - yarn run build
  - ./node_modules/.bin/karma start --single-run --browsers ChromeHeadlessTravis --reporters mocha
  # Run integration test to make sure our typings are correct for user-land.
  - node tools/run-typings-test.js
